import{j as M,c as i,F as w,a as t,t as d,u as c,G as v,H as b,o as l,f as h,I as g,g as P,J as N,q as $,b as _,w as S,d as C}from"./eq9DR6Uc.js";import{_ as j}from"./CLCxZ2ev.js";const L={class:"stats-summary text-white/70 text-sm space-y-4"},F={key:0,class:"animate-pulse"},O={class:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-2"},V={class:"rounded-xl border border-white/10 bg-white/5 px-3 py-2"},E={class:"text-white font-medium tabular-nums"},I={class:"rounded-xl border border-white/10 bg-white/5 px-3 py-2"},q={class:"text-white font-medium tabular-nums"},z={class:"rounded-xl border border-white/10 bg-white/5 px-3 py-2"},A={class:"text-white font-medium tabular-nums"},G={class:"rounded-xl border border-white/10 bg-white/5 px-3 py-2"},H={class:"text-white font-medium tabular-nums"},J={key:0,class:"mt-3"},R={class:"space-y-1.5 pl-0 list-none"},T={class:"w-16 shrink-0 text-white/70"},U={class:"tabular-nums text-white/50 shrink-0 w-8"},W={class:"flex-1 min-w-0 h-1.5 rounded-full bg-white/10 overflow-hidden max-w-32"},K={key:1,class:"mt-3"},Q={class:"space-y-1.5 pl-0 list-none max-h-40 overflow-y-auto"},X={class:"flex-1 min-w-0 text-white/70"},Y={class:"tabular-nums text-white/50 shrink-0"},Z={class:"w-16 h-1.5 rounded-full bg-white/10 shrink-0 overflow-hidden"},tt=["open"],et={class:"mt-2 space-y-1.5 pl-0 list-none max-h-48 overflow-y-auto"},st=["title"],nt={class:"tabular-nums text-white/50 shrink-0"},at=["title"],ot=M({__name:"StatsSummary",props:{summary:{},pending:{type:Boolean},defaultOpen:{type:Boolean,default:!1}},setup(o){const r=o,x={desktop:"桌面",mobile:"手机",tablet:"平板",bot:"爬虫",unknown:"未知"},u=e=>e>=1e8?`${(e/1e8).toFixed(1)}亿`:e>=1e4?`${(e/1e4).toFixed(1)}万`:e.toLocaleString(),m=h(()=>{const e=r.summary;return e?.byPath?.length?Math.max(...e.byPath.map(s=>s.views),1):1}),n=h(()=>{const e=r.summary?.byDevice;return!e||typeof e!="object"?[]:Object.entries(e).filter(([,s])=>(s??0)>0)}),y=h(()=>{const e=r.summary?.byDevice;return e?Math.max(...Object.values(e),1):1}),p=h(()=>{const e=r.summary?.byCountry;return e?.length?Math.max(...e.map(s=>s.views),1):1});function f(e,s){const a=s?e/s*100:0;return{width:`${Math.min(a,100)}%`}}function B(e){return x[e]??e}function D(e){return e?e.startsWith("/")?e:`/${e}`:"—"}return(e,s)=>(l(),i("div",L,[o.pending&&!o.summary?(l(),i("div",F," 统计加载中… ")):o.summary?(l(),i(w,{key:1},[t("div",O,[t("div",V,[s[0]||(s[0]=t("p",{class:"text-white/50 text-xs"},"近一周",-1)),t("p",E,d(u(o.summary.last7Days)),1)]),t("div",I,[s[1]||(s[1]=t("p",{class:"text-white/50 text-xs"},"近一月",-1)),t("p",q,d(u(o.summary.last30Days)),1)]),t("div",z,[s[2]||(s[2]=t("p",{class:"text-white/50 text-xs"},"近一年",-1)),t("p",A,d(u(o.summary.last365Days)),1)]),t("div",G,[s[3]||(s[3]=t("p",{class:"text-white/50 text-xs"},"总共",-1)),t("p",H,d(u(o.summary.total)),1)])]),c(n).length?(l(),i("div",J,[s[4]||(s[4]=t("p",{class:"text-white/50 mb-2"},"按设备分布",-1)),t("ul",R,[(l(!0),i(w,null,v(c(n),([a,k])=>(l(),i("li",{key:a,class:"flex items-center gap-2"},[t("span",T,d(B(a)),1),t("span",U,d(k),1),t("div",W,[t("div",{class:"h-full rounded-full bg-[color:var(--accent)]",style:g(f(k,c(y)))},null,4)])]))),128))])])):b("",!0),o.summary.byCountry?.length?(l(),i("div",K,[s[5]||(s[5]=t("p",{class:"text-white/50 mb-2"},"按地域分布",-1)),t("ul",Q,[(l(!0),i(w,null,v(o.summary.byCountry,a=>(l(),i("li",{key:a.code,class:"flex items-center gap-2"},[t("span",X,d(a.country),1),t("span",Y,d(a.views),1),t("div",Z,[t("div",{class:"h-full rounded-full bg-[color:var(--accent)]",style:g(f(a.views,c(p)))},null,4)])]))),128))])])):b("",!0),o.summary.byPath.length?(l(),i("details",{key:2,class:"mt-3 group/details",open:o.defaultOpen},[s[6]||(s[6]=t("summary",{class:"cursor-pointer list-none text-white/50 hover:text-white/70 inline-flex items-center gap-1"},[t("span",null,"按页面分布"),t("span",{class:"transition group-open/details:rotate-180"},"▼")],-1)),t("ul",et,[(l(!0),i(w,null,v(o.summary.byPath,a=>(l(),i("li",{key:a.path,class:"flex items-center gap-2"},[t("span",{class:"flex-1 min-w-0 truncate text-white/70",title:a.path},d(D(a.path)),9,st),t("span",nt,d(a.views),1),t("div",{class:"w-12 h-1.5 rounded-full bg-white/10 shrink-0 overflow-hidden",title:`${a.views} 次`},[t("div",{class:"h-full rounded-full bg-[color:var(--accent)]",style:g(f(a.views,c(m)))},null,4)],8,at)]))),128))])],8,tt)):b("",!0)],64)):b("",!0)]))}});function it(){const r=N().public.statsBase||"",x=r?`${r.replace(/\/$/,"")}/stats/summary`:"/api/stats/summary",u=$(null),m=$(!0),n=async()=>{m.value=!0;try{const y=await $fetch(x,{credentials:"same-origin"});u.value=y}catch{u.value=null}finally{m.value=!1}};return P(n),{summary:u,pending:m,refresh:n}}const lt={class:"max-w-3xl mx-auto py-10 px-6"},rt={class:"rounded-2xl border border-white/10 bg-white/5 backdrop-blur-md p-6"},ut={class:"flex items-center justify-between gap-4 mb-4"},dt=["disabled"],ct={class:"mt-6 flex gap-4 text-sm text-white/50"},xt=M({__name:"stats",setup(o){const r=it(),x=h(()=>r.summary.value),u=h(()=>r.pending.value);return(m,n)=>{const y=ot,p=j;return l(),i("section",lt,[n[4]||(n[4]=t("div",{class:"mb-8 flex flex-col gap-2"},[t("h1",{class:"text-2xl font-semibold text-white"},"访问统计"),t("p",{class:"text-sm text-white/50"},"仅后台查看，不对外展示")],-1)),t("div",rt,[t("div",ut,[n[1]||(n[1]=t("span",{class:"text-white/50 text-sm"},"数据来源：当前站点 API",-1)),t("button",{type:"button",class:"text-sm text-white/50 hover:text-white/70 transition disabled:opacity-50",disabled:c(u),onClick:n[0]||(n[0]=f=>c(r).refresh())}," 刷新 ",8,dt)]),_(y,{summary:c(x),pending:c(u),"default-open":!0},null,8,["summary","pending"])]),t("div",ct,[_(p,{to:"/blog",class:"hover:text-white transition"},{default:S(()=>[...n[2]||(n[2]=[C("返回博客",-1)])]),_:1}),_(p,{to:"/admin/",class:"hover:text-white transition"},{default:S(()=>[...n[3]||(n[3]=[C("内容后台",-1)])]),_:1})])])}}});export{xt as default};
