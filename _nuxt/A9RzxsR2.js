import P from"./BRo6LRps.js";import{u as j,_ as R}from"./CqJR-WUR.js";import{j as S,O as A,P as V,M as Y,e as F,c as a,a as r,u as t,S as H,F as _,t as d,H as i,G as k,k as L,b as T,N as q,o as s,R as z,f as E,Q as O,_ as G}from"./DDrHXbq5.js";import{u as I}from"./CarVn0lX.js";import{u as Q,a as U}from"./BudKRpDI.js";import{q as J}from"./DqxNAEaZ.js";import{u as K}from"./CR0sX7H7.js";import"./B2XXmpwf.js";import"./BSZFgSs5.js";import"./B8IaAclc.js";import"./BPfBr0MZ.js";import"./DaWJ0p5q.js";import"./Cgq_G8Uh.js";const W={class:"max-w-4xl mx-auto py-10 px-6"},X={class:"mt-6 rounded-3xl border border-white/10 bg-white/5 backdrop-blur-xl p-8 md:p-10 shadow-[0_30px_80px_rgba(0,0,0,0.45)]"},Z={key:0,class:"snapshot-skeleton space-y-6"},tt={class:"text-4xl md:text-5xl font-semibold text-white mb-4"},et={class:"text-sm text-white/60 mb-6 flex flex-wrap items-center gap-4"},st={key:0,class:"text-white/40"},at={key:1,class:"text-white/40"},ot={key:2,class:"text-white/40"},nt={key:0,class:"text-white/70 mb-6"},rt={key:1,class:"grid gap-3 sm:grid-cols-2 mb-8"},it=["src","loading","fetchpriority"],dt={key:2,class:"flex flex-wrap gap-2 mb-8"},lt={class:"prose prose-invert max-w-none"},ct=["innerHTML"],ut={key:0,class:"mt-10"},pt=S({__name:"[...slug]",async setup(mt){let l,x;const c=A(),C=V(),$=()=>{window.history.length>1?C.back():z("/snapshots")},f=q().public.baseUrl||"/",v=f.replace(/\/$/,"")+c.path,{views:g}=I(v),{count:b}=j(v),y=Array.isArray(c.params.slug)?c.params.slug.join("/"):c.params.slug,p=`/snapshots/${y}`,D=f.replace(/\/$/,""),{data:e,pending:m}=([l,x]=Y(async()=>Q(`snapshot-${p}`,async()=>{const n=U(`snapshot-${p}`).data.value;if(n)return n;try{return await J(p).findOne()}catch{return await $fetch(`${D}/snapshots/${y}.json`).catch(()=>null)??null}},{getCachedData:()=>{},lazy:!0})),l=await l,x(),l);F([m,e],([n,o])=>{if(!n&&!o)throw O({statusCode:404,statusMessage:"Page not found"})},{immediate:!0});const w=E(()=>{const o=e.value?.body;return typeof o=="string"?o:null});function B(n){return n?K(n,"YYYY-MM-DD").value:""}return(n,o)=>{const M=P,N=R;return s(),a("article",W,[r("button",{type:"button",class:"inline-block bg-transparent border-0 p-0 text-left text-xs uppercase tracking-[0.35em] text-white/50 hover:text-white/70 transition cursor-pointer font-inherit",onClick:$}," ← 返回快照 "),r("div",X,[t(m)?(s(),a("div",Z,[...o[0]||(o[0]=[H('<div class="snapshot-skeleton-line h-3 w-24 rounded-full" data-v-b82ddd20></div><div class="snapshot-skeleton-line h-10 max-w-xl rounded-lg" data-v-b82ddd20></div><div class="snapshot-skeleton-line h-4 w-56 rounded-full" data-v-b82ddd20></div><div class="grid gap-3 sm:grid-cols-2 pt-4" data-v-b82ddd20><div class="snapshot-skeleton-line aspect-[4/3] w-full rounded-2xl" data-v-b82ddd20></div><div class="snapshot-skeleton-line aspect-[4/3] w-full rounded-2xl" data-v-b82ddd20></div></div><div class="space-y-2 pt-4" data-v-b82ddd20><div class="snapshot-skeleton-line h-4 w-full rounded" data-v-b82ddd20></div><div class="snapshot-skeleton-line h-4 max-w-[80%] rounded" data-v-b82ddd20></div></div>',5)])])):t(e)?(s(),a(_,{key:1},[o[1]||(o[1]=r("p",{class:"text-xs uppercase tracking-[0.4em] text-white/40 mb-4"},"Snapshot",-1)),r("h1",tt,d(t(e).title),1),r("div",et,[r("span",null,d(B(t(e).date)),1),t(e).location?(s(),a("span",st,"· "+d(t(e).location),1)):i("",!0),t(g)!==null?(s(),a("span",at,"· "+d(t(g))+" 次浏览",1)):i("",!0),t(b)!==null?(s(),a("span",ot," · "+d(t(b))+" 条评论 ",1)):i("",!0)]),t(e).summary?(s(),a("p",nt,d(t(e).summary),1)):i("",!0),t(e).images&&t(e).images.length?(s(),a("div",rt,[(s(!0),a(_,null,k(t(e).images,(u,h)=>(s(),a("div",{key:`${t(e)._path}-img-${h}`,class:"flex items-start justify-center overflow-hidden"},[r("img",{src:u,alt:"snapshot",loading:h===0?"eager":"lazy",fetchpriority:h===0?"high":"auto",decoding:"async",class:"block h-auto w-full max-h-[32rem] max-w-[42rem] rounded-2xl border border-white/15 object-contain"},null,8,it)]))),128))])):i("",!0),t(e).tags?(s(),a("div",dt,[(s(!0),a(_,null,k(t(e).tags,u=>(s(),a("span",{key:u,class:"px-3 py-1 text-xs uppercase tracking-[0.2em] text-white/60 border border-white/10 rounded-full"},d(u),1))),128))])):i("",!0),r("div",lt,[t(w)?(s(),a("div",{key:0,innerHTML:t(w)},null,8,ct)):(s(),L(M,{key:1,value:t(e)},null,8,["value"]))])],64)):i("",!0)]),!t(m)&&t(e)?(s(),a("div",ut,[o[2]||(o[2]=r("div",{class:"text-xs uppercase tracking-[0.35em] text-white/50 mb-4"}," Comments ",-1)),T(N)])):i("",!0)])}}}),Mt=G(pt,[["__scopeId","data-v-b82ddd20"]]);export{Mt as default};
