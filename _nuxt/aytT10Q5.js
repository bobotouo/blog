import{j as O,g as x,h as S,o as h,c as g,b as I,T as L,w as E,u as C,a as b,H as _,q as f,L as R,f as w,_ as B}from"./Cdp6UD9U.js";import{u as H}from"./D3p06FQ0.js";import{u as M}from"./Bl8_77Ba.js";const j={key:0,class:"space-y-3"},q={key:0,class:"text-sm text-white/60"},G=O({__name:"Comments",setup(n){const o=f(null),i=f(!1),a=f(!1);let c=null;const r=R(),m=r.public.giscusRepo||"",p=r.public.giscusRepoId||"",s=r.public.giscusCategory||"Announcements",t=r.public.giscusCategoryId||"",u=r.public.giscusTheme||"",l=u&&u!=="preferred_color_scheme"?u:"dark_dimmed",v=w(()=>!!m&&!!p&&!!t),k=w(()=>!1),T=w(()=>v.value&&!a.value);H({link:[{rel:"dns-prefetch",href:"https://giscus.app"},{rel:"dns-prefetch",href:"https://github.githubassets.com"},{rel:"preconnect",href:"https://giscus.app",crossorigin:""},{rel:"preconnect",href:"https://github.githubassets.com",crossorigin:""}]});const N=()=>{if(i.value||!o.value||!v.value)return;const e=document.createElement("script");e.src="https://giscus.app/client.js",e.async=!0,e.crossOrigin="anonymous",e.setAttribute("data-repo",m),e.setAttribute("data-repo-id",p),e.setAttribute("data-category",s),e.setAttribute("data-category-id",t),e.setAttribute("data-mapping","specific");const d=typeof window<"u"?window.location.pathname:"";d&&e.setAttribute("data-term",d),e.setAttribute("data-reactions-enabled","1"),e.setAttribute("data-emit-metadata","0"),e.setAttribute("data-input-position","bottom"),e.setAttribute("data-theme",l),e.setAttribute("data-lang","zh-CN"),o.value.appendChild(e),i.value=!0},y=()=>{if(!o.value)return;const e=o.value.querySelector(".giscus-frame");e&&(e.dataset.readyBound!=="1"&&(e.dataset.readyBound="1",e.addEventListener("load",()=>{a.value=!0})),e.contentWindow&&(a.value=!0))};return x(()=>{o.value&&(a.value=!1,c=new MutationObserver(()=>{y()}),c.observe(o.value,{childList:!0,subtree:!0}),N(),y())}),S(()=>{c&&(c.disconnect(),c=null)}),(e,d)=>(h(),g("div",{id:"comments",ref_key:"commentsContainer",ref:o,class:"my-8 rounded-2xl border border-white/10 bg-white/5 backdrop-blur-md p-4 md:p-6"},[I(L,{name:"skeleton-fade"},{default:E(()=>[C(T)?(h(),g("div",j,[...d[0]||(d[0]=[b("div",{class:"h-4 w-40 rounded bg-white/10 animate-pulse"},null,-1),b("div",{class:"h-20 w-full rounded-xl bg-white/10 animate-pulse"},null,-1),b("div",{class:"h-20 w-full rounded-xl bg-white/10 animate-pulse"},null,-1)])])):_("",!0)]),_:1}),C(k)?(h(),g("p",q," 评论系统未配置：请在本地环境变量中设置 Giscus 参数后重启开发服务。 ")):_("",!0)],512))}}),W=B(G,[["__scopeId","data-v-107197ea"]]),V=600*1e3,A="blog-comment-count-cache-v1",z=n=>{const o=f(null),i=M("comment-count-cache",()=>({})),a=()=>{try{const s=window.localStorage.getItem(A);if(!s)return{};const t=JSON.parse(s);return t&&typeof t=="object"?t:{}}catch{return{}}},c=s=>{try{window.localStorage.setItem(A,JSON.stringify(s))}catch{}},r=()=>{const s=Date.now(),t=i.value[n];if(t&&t.expiresAt>s)return t.comments;const l=a()[n];return l&&l.expiresAt>s?(i.value[n]=l,l.comments):null},m=s=>{const t={comments:s,expiresAt:Date.now()+V};i.value[n]=t;const u=a();u[n]=t,c(u)},p=async()=>{const s=r();if(s!==null){o.value=s;return}try{const t=await $fetch("/api/comments",{query:{path:n},timeout:4500});typeof t?.comments=="number"&&(o.value=t.comments,m(t.comments))}catch{}};return x(()=>{p()}),{count:o}};export{W as _,z as u};
